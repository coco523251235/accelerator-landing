<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€å…è²»ã€‘å…§åœ¨ç¯€å¥åŠ é€Ÿå™¨ï¼šç©©å®šå¿ƒæ™ºèˆ‡æ±ºç­–åŠ›</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase å°å…¥ï¼šåå–®æ”¶é›† -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // å…¨åŸŸè®Šæ•¸å®šç¾©
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initialAuthToken : null;

        window.firebase = {}; 
        window.firebase.db = null;
        window.firebase.userId = null;
        
        // Firebase åˆå§‹åŒ–
        window.initializeFirebase = async function() {
            try {
                setLogLevel('error'); 

                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const auth = getAuth(app);
                
                window.firebase.db = db;

                // èº«ä»½é©—è­‰
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        window.firebase.userId = user.uid;
                        console.log("Firebase åˆå§‹åŒ–æˆåŠŸã€‚");
                    }
                });

            } catch (error) {
                console.error("Firebase åˆå§‹åŒ–å¤±æ•—:", error);
                showCustomMessage("è³‡æ–™åº«é€£ç·šå¤±æ•—ï¼Œåå–®æ”¶é›†åŠŸèƒ½å¯èƒ½ç„¡æ³•é‹ä½œã€‚", 'error');
            }
        }
        
        /**
         * å„²å­˜é›»å­éƒµä»¶å’Œåç¨±åˆ° Firestore
         */
        window.saveLeadEmail = async function(name, email) {
            const db = window.firebase.db;
            const userId = window.firebase.userId;

            if (!db || !userId) {
                showCustomMessage("è³‡æ–™åº«å°šæœªæº–å‚™å¥½ï¼Œè«‹ç¨ç­‰å†è©¦ä¸€æ¬¡ã€‚", 'warning');
                return false;
            }

            try {
                // è³‡æ–™æœƒå„²å­˜åœ¨ /artifacts/{appId}/public/data/general_leads é›†åˆä¸­
                const leadsCollectionRef = collection(db, `artifacts/${appId}/public/data/general_leads`);
                
                await addDoc(leadsCollectionRef, {
                    name: name, // å§“å
                    email: email, 
                    userId: userId,
                    source: 'rhythm_accelerator_v19', // æ›´æ–°ç‰ˆæœ¬è™Ÿ
                    timestamp: new Date().toISOString()
                });

                showCustomMessage("è§£é–æˆåŠŸï¼è«‹é»æ“Šæ’­æ”¾æŒ‰éˆ•é–‹å§‹ 12 åˆ†é˜å¼•å°ã€‚", 'success');
                return true;

            } catch (error) {
                console.error("å„²å­˜é›»å­éƒµä»¶å¤±æ•—:", error);
                showCustomMessage("å„²å­˜æ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚è«‹ç¢ºèªæ‚¨çš„è³‡è¨Šæ˜¯å¦æ­£ç¢ºã€‚", 'error');
                return false;
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .bg-page {
            /* æ·ºè‰²ã€æ¸…æ–°çš„èƒŒæ™¯ */
            background: linear-gradient(135deg, #f3f4f6 0%, #ffffff 100%);
        }
        /* æ’­æ”¾æŒ‰éˆ•è„ˆå‹•æ•ˆæœ - Teal ä»£è¡¨æµå‹•èˆ‡å¿ƒæµ */
        @keyframes subtle-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(20, 184, 166, 0.4); } /* teal-500 */
            50% { transform: scale(1.02); box-shadow: 0 0 15px rgba(20, 184, 166, 0.8); }
        }
        .pulse-effect {
            animation: subtle-pulse 3s infinite ease-in-out;
        }
        /* è½‰æ›æŒ‰éˆ•çš„é–ƒçˆ - ç´…è‰²ï¼Œè§£æ±ºæ ¸å¿ƒå•é¡Œçš„è¿«åˆ‡æ€§ */
        @keyframes conversion-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } /* red-500 */
            50% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
        }
        .cta-pulse-animation {
            animation: conversion-pulse 2.5s infinite;
        }
        /* éš±è—æ¨™æº–æ’­æ”¾å™¨ä½†ä¿ç•™æ§åˆ¶æ¬Š */
        #audioPlayer { display: none; }
    </style>
</head>
<body class="bg-page min-h-screen text-gray-900 flex justify-center items-center p-4">

    <!-- è‡ªå®šç¾©è¨Šæ¯æ¡† -->
    <div id="customMessageContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="w-full max-w-md bg-white p-8 rounded-3xl shadow-2xl border border-gray-200 flex flex-col items-center gap-6">

        <header class="text-center">
            <h1 class="text-3xl font-extrabold text-indigo-800 mb-2">ğŸš€ å…§åœ¨ç¯€å¥åŠ é€Ÿå™¨</h1>
            <p class="text-gray-600 text-md">ç»çµ¦æ‰€æœ‰ã€Œè©²ç¡ç¡ä¸è‘—ã€è©²åšå»ä¸åšã€çš„é«˜å£“äººç¾¤ï¼Œæ‰¾å›æ‚¨çš„ç¯€å¥èˆ‡å‹‡æ°£ã€‚</p>
        </header>

        <!-- éŸ³é »æ’­æ”¾å™¨ (éš±è—) -->
        <audio id="audioPlayer">
            <!-- â­ï¸ æ›¿æ›é» 1: æ‚¨çš„ 12 åˆ†é˜éŸ³é »åŸå§‹é€£çµ â­ï¸ -->
            <source src="https://drive.google.com/file/d/1uNpibQkB_M1xuSlicsFW58bRG2aHwtdK/view?usp=sharing" type="audio/mp3"> 
            æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒéŸ³é »æ’­æ”¾ã€‚
        </audio>

        <!-- åå–®æ”¶é›†å€å¡Šï¼šéŸ³é »è§£é– -->
        <div id="emailFormBlock" class="w-full p-5 bg-gray-50 rounded-2xl border border-indigo-200 shadow-inner text-center">
            <h3 class="text-xl font-bold text-teal-600 mb-3 flex items-center justify-center gap-2">
                <i data-lucide="lock" class="w-6 h-6"></i> ç«‹å³è§£é–ã€12 åˆ†é˜å¿ƒæµå¼•å°éŸ³é »ã€‘
            </h3>
            <p class="text-gray-600 mb-4 text-sm">è¼¸å…¥æ‚¨çš„è³‡è¨Šï¼Œå³å¯ç²å–é€™ä»½é«˜åƒ¹å€¼å¼•å°ï¼Œä¸¦è§£é–ä¸‹æ–¹çš„å°ˆå±¬æ•™ç·´é€šé“ã€‚</p>
            
            <form id="emailForm" class="flex flex-col space-y-3">
                
                <!-- åç¨±æ¬„ä½ (å¿…å¡«) -->
                <input type="text" id="nameInput" placeholder="æ‚¨çš„ç¨±è¬‚ (å¿…å¡«)" required
                       class="w-full px-4 py-3 rounded-lg bg-white border border-gray-300 text-gray-900 placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500">
                
                <!-- ä¿¡ç®±æ¬„ä½ (å¿…å¡«) -->
                <input type="email" id="emailInput" placeholder="æ‚¨çš„é›»å­ä¿¡ç®± (å¿…å¡«)" required
                       class="w-full px-4 py-3 rounded-lg bg-white border border-gray-300 text-gray-900 placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500">
                       
                <button type="submit" id="submitEmailButton"
                        class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-bold text-white transition duration-300 shadow-md">
                    <i data-lucide="mail" class="w-5 h-5 inline mr-2"></i> ç«‹å³è§£é–æ‚¨çš„å°ˆå±¬é€šé“
                </button>
            </form>
        </div>
        
        <!-- è‡ªå®šç¾©éŸ³é »æ§åˆ¶å€ (åˆå§‹é–å®š) -->
        <div id="audioControls" class="w-full mt-4 opacity-50 pointer-events-none transition-opacity duration-300">
            <div id="visualizer" class="h-10 bg-gray-200 rounded-lg mb-4 flex items-center justify-center text-sm text-red-600 font-bold">
                <i data-lucide="lock" class="w-4 h-4 mr-2"></i> è«‹å…ˆè¼¸å…¥è³‡è¨Šè§£é–éŸ³é »æ’­æ”¾
            </div>

            <button id="playButton" disabled
                    class="w-full py-5 rounded-2xl font-bold text-xl bg-gray-300 shadow-lg cursor-not-allowed text-gray-600">
                <i data-lucide="play" class="w-6 h-6 inline mr-2"></i> å•Ÿå‹• 12 åˆ†é˜å¿ƒæµé‡ç½®å¼•å°
            </button>
            
            <p id="timerDisplay" class="text-center text-sm text-gray-500 mt-2">
                æ™‚é•·: <span id="currentTime">--:--</span> / <span id="durationTime">--:--</span>
            </p>
        </div>
        
        <!-- è½‰æ›é»ï¼šè«®è©¢å€å¡Š (åˆå§‹é–å®š) -->
        <div id="conversionBlock" class="w-full mt-4 p-5 bg-white rounded-2xl border border-red-300 shadow-lg text-center opacity-30 pointer-events-none transition-opacity duration-500">
            
            <h3 class="text-xl font-extrabold text-red-600 mb-3 flex items-center justify-center gap-2">
                <i data-lucide="alert-triangle" class="w-5 h-5"></i> å¾ç‰‡åˆ»å¹³éœåˆ°æŒä¹…ç©©å®šï¼šä¸‹ä¸€æ­¥ï¼Ÿ
            </h3>
            
            <p class="text-gray-600 mb-5 text-sm">
                å–®æ¬¡å¼•å°åƒ…èƒ½æä¾›ç‰‡åˆ»å®‰å®šï¼Œç„¡æ³•æ ¹æ²»æ‚¨é«”å…§**ä¸æ–·å¾ªç’°çš„å£“åŠ›èˆ‡çŒ¶è±«ä¸æ±ºçš„æ…£æ€§**ã€‚
                è‹¥æƒ³å°‡é€™ä»½å®‰å®šæ„Ÿ**å…§åŒ–ç‚ºæŒä¹…çš„è¡Œå‹•æ…£æ€§**ï¼Œä¸¦**å¾¹åº•æ ¹é™¤å£“åŠ›è¿´åœˆ**ï¼Œæ‚¨éœ€è¦ä¸€å€‹å°ˆå±¬çš„ç³»çµ±æ€§é‡å¡‘è¨ˆç•«ã€‚
            </p>

            <!-- CTA æŒ‰éˆ•ï¼šå‹‡æ°£åŠ é€Ÿå™¨åç¨±æ”¾åœ¨é€™è£¡ -->
            <!-- â­ï¸ æ›¿æ›é» 2: è«‹ç”¨æ‚¨çš„ Line ID é€£çµæˆ–é ç´„è«®è©¢é é¢é€£çµæ›¿æ›æ­¤è™•çš„ URL â­ï¸ -->
            <a id="consultationLink" href="https://https://lemonhumandesign.com/book-a-call/" target="_blank"
               class="w-full inline-flex items-center justify-center py-4 rounded-xl font-bold text-lg transition duration-300 bg-red-600 hover:bg-red-700 shadow-xl text-white">
                <i data-lucide="rocket" class="w-6 h-6 inline mr-2"></i> ç«‹å³é ç´„æ•™ç·´ï¼šå°ˆå±¬å‹‡æ°£åŠ é€Ÿå™¨è«®è©¢
            </a>
            
        </div>

    </div>

    <script>
        // --- åˆå§‹åŒ– & è®Šæ•¸ ---
        lucide.createIcons();
        window.initializeFirebase(); // å‘¼å« Firebase åˆå§‹åŒ–
        
        const audioPlayer = document.getElementById('audioPlayer');
        const playButton = document.getElementById('playButton');
        const visualizer = document.getElementById('visualizer');
        const currentTimeDisplay = document.getElementById('currentTime');
        const durationTimeDisplay = document.getElementById('durationTime');
        const consultationLink = document.getElementById('consultationLink');
        const emailForm = document.getElementById('emailForm');
        const nameInput = document.getElementById('nameInput'); // åç¨±è¼¸å…¥æ¬„
        const emailInput = document.getElementById('emailInput');
        const conversionBlock = document.getElementById('conversionBlock');
        const audioControls = document.getElementById('audioControls'); 
        const emailFormBlock = document.getElementById('emailFormBlock');
        
        let isPlaying = false;
        let emailSubmitted = false; 

        /** è‡ªå®šç¾©è¨Šæ¯æ¡† (å–ä»£ alert()) */
        function showCustomMessage(message, type = 'success') {
            const container = document.getElementById('customMessageContainer');
            const color = type === 'success' ? 'bg-teal-500' : type === 'error' ? 'bg-red-500' : 'bg-yellow-500';

            const msgBox = document.createElement('div');
            msgBox.className = `p-4 rounded-lg shadow-xl text-white ${color} transition transform duration-300 ease-out translate-x-0`;
            msgBox.textContent = message;

            container.appendChild(msgBox);

            setTimeout(() => {
                msgBox.classList.add('-translate-x-full', 'opacity-0');
                msgBox.addEventListener('transitionend', () => msgBox.remove());
            }, 5000);
        }

        // --- åå–®æ”¶é›†é‚è¼¯ï¼šæˆåŠŸå¾Œè§£é–æ‰€æœ‰åŠŸèƒ½ ---
        emailForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = nameInput.value.trim();
            const email = emailInput.value.trim();

            if (!name) {
                 showCustomMessage("è«‹å¡«å¯«æ‚¨çš„ç¨±è¬‚ã€‚", 'warning');
                 nameInput.focus();
                 return;
            }

            if (!email || !email.includes('@')) {
                showCustomMessage("è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­ä¿¡ç®±æ ¼å¼ã€‚", 'warning');
                emailInput.focus();
                return;
            }

            const success = await window.saveLeadEmail(name, email); // å‚³å…¥åç¨±å’Œä¿¡ç®±
            
            if (success) {
                emailSubmitted = true;
                
                // 1. è§£é–éŸ³é »æ§åˆ¶å€
                audioControls.classList.remove('opacity-50', 'pointer-events-none');
                playButton.disabled = false;
                playButton.classList.remove('bg-gray-300', 'cursor-not-allowed', 'text-gray-600');
                playButton.classList.add('bg-teal-500', 'hover:bg-teal-600', 'pulse-effect', 'text-white');
                visualizer.innerHTML = '<i data-lucide="check-circle" class="w-4 h-4 mr-2"></i> å·²è§£é–ï¼é»æ“Šæ’­æ”¾æŒ‰éˆ•é–‹å§‹å¼•å°ã€‚';
                
                // 2. è§£é– CTA å€å¡Š
                conversionBlock.classList.remove('opacity-30', 'pointer-events-none');
                
                // 3. éš±è—åå–®è¡¨å–®å€å¡Š (è®“ç‰ˆé¢æ›´ä¹¾æ·¨)
                emailFormBlock.classList.add('hidden');

                showCustomMessage("è§£é–æˆåŠŸï¼è«‹é»æ“Šæ’­æ”¾éŸ³é »ï¼Œä¸¦æŸ¥çœ‹ä¸‹æ–¹çš„å°ˆå±¬æ•™ç·´é€šé“ã€‚", 'success');
            }
            lucide.createIcons();
        });


        // --- éŸ³é »æ’­æ”¾é‚è¼¯ (åƒ…åœ¨è§£é–å¾Œé‹è¡Œ) ---

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        audioPlayer.addEventListener('loadedmetadata', () => {
            durationTimeDisplay.textContent = formatTime(audioPlayer.duration);
        });

        audioPlayer.addEventListener('timeupdate', () => {
            currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
            
            // æ’­æ”¾è¶…éä¸€åŠæˆ–æœ€å¾Œ 30 ç§’ï¼Œå¼·åˆ¶è®“ CTA é–ƒçˆ
            if (emailSubmitted && audioPlayer.duration > 60 && (audioPlayer.currentTime > audioPlayer.duration / 2 || audioPlayer.currentTime > audioPlayer.duration - 30)) {
                consultationLink.classList.add('cta-pulse-animation');
            }
        });

        audioPlayer.addEventListener('ended', () => {
            isPlaying = false;
            playButton.innerHTML = '<i data-lucide="repeat" class="w-6 h-6 inline mr-2"></i> å†æ¬¡é‡ç½®å…§åœ¨ç¯€å¥';
            playButton.classList.remove('bg-teal-700', 'hover:bg-teal-800', 'pulse-effect'); // åœæ­¢è„ˆå‹•
            playButton.classList.add('bg-teal-500', 'hover:bg-teal-600'); // å›åˆ°æ­£å¸¸æµå‹•è‰²
            visualizer.innerHTML = '<i data-lucide="check-circle" class="w-4 h-4 mr-2"></i> å¼•å°å®Œæˆã€‚æ˜¯æ™‚å€™å•Ÿå‹•åŠ é€Ÿè¨ˆç•«äº†ï¼';
            if (emailSubmitted) {
                // æ’­æ”¾çµæŸå¾Œï¼Œå¼·åˆ¶é–ƒçˆå¼•å°è½‰æ›
                consultationLink.classList.add('cta-pulse-animation');
            }
            lucide.createIcons();
        });

        playButton.addEventListener('click', () => {
            // æª¢æŸ¥éŸ³é »æ˜¯å¦å·²æ›¿æ›
            if (audioPlayer.currentSrc.includes('my-sleep-guide.mp3')) {
                 showCustomMessage("ğŸš¨ è«‹å…ˆå°‡éŸ³é »æª”æ¡ˆä¸Šå‚³åˆ° GitHubï¼Œä¸¦æ›´æ–° HTML ç¨‹å¼ç¢¼ä¸­çš„éŸ³é »é€£çµã€‚", 'error');
                 return;
            }

            if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
                playButton.innerHTML = '<i data-lucide="pause" class="w-6 h-6 inline mr-2"></i> ç¹¼çºŒå¼•å° (å¿ƒæ™ºå®šéŒ¨)';
                playButton.classList.remove('bg-teal-700', 'hover:bg-teal-800'); 
                playButton.classList.add('bg-teal-500', 'hover:bg-teal-600');
                visualizer.textContent = 'â¸ï¸ å¼•å°å·²æš«åœï¼Œéš¨æ™‚å¯ä»¥ç¹¼çºŒ';
            } else {
                audioPlayer.play().catch(e => {
                    showCustomMessage("ç€è¦½å™¨éœ€è¦ç”¨æˆ¶äº’å‹•æ‰èƒ½é–‹å§‹æ’­æ”¾ã€‚è«‹å†é»æ“Šä¸€æ¬¡æ’­æ”¾æŒ‰éˆ•ã€‚", 'warning');
                    console.error("Audio playback error:", e);
                });
                isPlaying = true;
                playButton.innerHTML = '<i data-lucide="pause" class-="w-6 h-6 inline mr-2"></i> æš«åœå¼•å°';
                playButton.classList.remove('bg-teal-500', 'hover:bg-teal-600'); 
                playButton.classList.add('bg-teal-700', 'hover:bg-teal-800'); // æ’­æ”¾æ™‚è®Šæ·±è‰²ï¼Œå¢åŠ å°ˆæ³¨æ„Ÿ
                visualizer.textContent = 'ğŸ¶ å…§åœ¨ç¯€å¥é‡å¡‘ä¸­...è«‹å°ˆæ³¨æ–¼æ‚¨çš„ç©©å®šèˆ‡åŸ·è¡ŒåŠ›ã€‚';
                playButton.classList.add('pulse-effect');
            }
            lucide.createIcons();
        });

        // æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–
        window.onload = () => {
            // åˆå§‹ç‹€æ…‹ï¼šéŸ³é »æ§åˆ¶å€æ˜¯é–å®šçš„
            visualizer.innerHTML = '<i data-lucide="lock" class="w-4 h-4 mr-2"></i> è«‹å…ˆè¼¸å…¥è³‡è¨Šè§£é–éŸ³é »æ’­æ”¾';
        };

    </script>
</body>
</html>